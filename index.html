<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>NEON FIT // DASHBOARD</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800;900&family=Inter:wght@400;500;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --cyan: #00eaff;
      --magenta: #ff2d95;
      --dark-bg: #050510;
    }
    body {
      background-color: var(--dark-bg);
      font-family: 'Inter', sans-serif;
      color: white;
      padding-bottom: env(safe-area-inset-bottom);
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .font-hud { font-family: 'Rajdhani', sans-serif; }
    .font-mono-tech { font-family: 'Share Tech Mono', monospace; }
    
    /* Neon Glows */
    .glow-text-cyan { text-shadow: 0 0 10px rgba(0, 234, 255, 0.6); }
    .glow-text-magenta { text-shadow: 0 0 10px rgba(255, 45, 149, 0.6); }

    /* XP Bar Animation */
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .xp-fill {
      background: linear-gradient(90deg, var(--cyan), #fff, var(--cyan));
      background-size: 200% 100%;
      animation: shimmer 3s infinite linear;
    }

    /* Canvas Background */
    #matrix-bg {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #050510 100%);
    }

    /* --- IPHONE OPTIMIZED INTERACTIONS --- */
    .touch-pop {
        transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), filter 0.1s;
        will-change: transform;
        transform: translateZ(0); /* GPU Accel */
        cursor: pointer;
    }
    .touch-pop:active {
        transform: scale(0.96);
        filter: brightness(1.3);
    }
    
    /* Sheen Effect for Cards */
    .card-sheen {
        position: relative;
        overflow: hidden;
    }
    .card-sheen::after {
        content: '';
        position: absolute;
        top: 0; left: -150%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transform: skewX(-25deg);
        transition: left 0.5s;
        pointer-events: none;
    }
    .card-sheen:active::after {
        left: 150%;
        transition: left 0.3s;
    }

    /* STAGGERED ANIMATIONS */
    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-entry {
        animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
    }

    /* MODAL */
    .modal-overlay {
        position: fixed; inset: 0; z-index: 100;
        background: rgba(5, 5, 16, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-content {
        width: 90%; max-height: 80vh; overflow-y: auto;
        background: #0f0f20; border: 1px solid rgba(255,255,255,0.1);
        border-radius: 24px; padding: 20px;
        transform: scale(0.9); transition: transform 0.3s;
        box-shadow: 0 0 50px rgba(0,234,255,0.1);
    }
    .modal-overlay.open .modal-content { transform: scale(1); }
    
    /* Grid Pattern for Protocol Widget */
    .bg-grid-pattern {
        background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        background-size: 20px 20px;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body class="antialiased">
  <!-- FIX FOR IOS ACTIVE STATES -->
  <script>document.addEventListener("touchstart", function(){}, true);</script>

  <canvas id="matrix-bg"></canvas>

  <!-- GAMIFICATION HEADER -->
  <div class="fixed top-0 w-full z-50 bg-[#050510]/95 backdrop-blur-xl border-b border-white/10 pt-safe px-4 pb-3 shadow-lg">
      <div class="flex justify-between items-end mb-2">
          <div class="flex flex-col">
              <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-0.5">RANG OPÉRATEUR</span>
              <span class="text-base font-hud font-black text-white uppercase glow-text-cyan tracking-wide" id="user-rank">RECRUE IV</span>
          </div>
          <div class="text-right">
               <span class="text-xs font-mono-tech text-cyan-400 font-bold" id="xp-display">0 / 1000 XP</span>
          </div>
      </div>
      <!-- XP Bar -->
      <div class="h-2 w-full bg-slate-800/50 rounded-full overflow-hidden relative border border-white/5">
          <div class="h-full xp-fill absolute top-0 left-0 shadow-[0_0_10px_var(--cyan)]" id="xp-bar" style="width: 0%"></div>
      </div>
  </div>

  <main class="relative z-10 pt-[100px] pb-32 px-4 space-y-8">

      <!-- HERO SECTION -->
      <section class="mt-2 text-center animate-entry" style="animation-delay: 0s;">
          <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 mb-4 shadow-[0_0_20px_rgba(255,45,149,0.2)]">
              <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-magenta-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-[var(--magenta)]"></span>
              </span>
              <span class="text-[10px] font-bold uppercase tracking-widest text-slate-300">SYSTÈME V3.0 ELITE</span>
          </div>
          <h1 class="text-4xl font-hud font-black text-white italic leading-[0.9] mb-2 drop-shadow-xl">
              PASSEZ AU <br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-[var(--cyan)] to-[var(--magenta)] glow-text-cyan">NIVEAU SUPÉRIEUR</span>
          </h1>
          <p class="text-xs text-slate-400 max-w-[260px] mx-auto leading-relaxed">Accomplissez les missions. Gagnez de l'XP. Devenez une Élite.</p>
      </section>

      <!-- IDENTITY CARD (PREMIUM UNIFIED) -->
      <section class="animate-entry" style="animation-delay: 0.1s;">
          <div class="bg-[#0a0a15] border border-white/10 rounded-3xl p-1 relative overflow-hidden shadow-2xl touch-pop group">
              <!-- Animated Border Glow -->
              <div class="absolute inset-0 bg-gradient-to-r from-[var(--cyan)]/20 to-[var(--magenta)]/20 opacity-0 group-active:opacity-100 transition-opacity duration-300"></div>
              
              <div class="relative z-10 flex items-center justify-between bg-[#0f172a]/80 backdrop-blur-xl rounded-[20px] p-4">
                  <!-- Streak -->
                  <div class="flex-1 flex flex-col items-center border-r border-white/5">
                      <div class="relative mb-1">
                          <i data-lucide="flame" class="w-8 h-8 text-orange-500 fill-orange-500/20 drop-shadow-[0_0_15px_rgba(249,115,22,0.6)]"></i>
                      </div>
                      <div class="text-4xl font-hud font-black text-white leading-none">3</div>
                      <div class="text-[8px] font-bold text-slate-500 uppercase tracking-widest mt-1">SÉRIE JOURS</div>
                  </div>

                  <!-- Level Badge -->
                  <div class="flex-1 flex flex-col items-center">
                      <div class="relative mb-1">
                          <i data-lucide="award" class="w-8 h-8 text-[var(--cyan)] drop-shadow-[0_0_15px_rgba(0,234,255,0.6)]"></i>
                      </div>
                      <div class="text-4xl font-hud font-black text-white leading-none" id="level-display">1</div>
                      <div class="text-[8px] font-bold text-slate-500 uppercase tracking-widest mt-1">NIVEAU ACTUEL</div>
                  </div>
              </div>
          </div>
      </section>

      <!-- CURRENT PROTOCOL WIDGET (HOLOGRAPHIC GRID) -->
      <section class="animate-entry" style="animation-delay: 0.2s;">
          <div class="bg-[#0a0a15] border border-[var(--cyan)]/30 rounded-3xl p-5 shadow-[0_0_40px_rgba(0,234,255,0.1)] relative overflow-hidden touch-pop group">
              <!-- Grid Background -->
              <div class="absolute inset-0 bg-grid-pattern opacity-20"></div>
              <!-- Scanline -->
              <div class="absolute inset-0 bg-gradient-to-b from-transparent via-[var(--cyan)]/5 to-transparent h-[200%] translate-y-[-50%] animate-[spin_4s_linear_infinite] opacity-30 pointer-events-none"></div>
              
              <div class="relative z-10">
                  <div class="flex justify-between items-start mb-4">
                      <div>
                          <div class="text-[9px] font-bold text-cyan-500/80 uppercase tracking-[0.2em] mb-1 flex items-center gap-2">
                              <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"></span> ACTIVE PROTOCOL
                          </div>
                          <h2 class="text-3xl font-hud font-black text-white leading-[0.9] tracking-wide" id="protocol-title">LOADING</h2>
                          <h3 class="text-2xl font-hud font-bold text-slate-400 leading-[0.9]" id="protocol-subtitle">...</h3>
                      </div>
                      <div class="bg-[#050510]/80 border border-white/10 rounded-xl p-2 text-center min-w-[60px] shadow-lg backdrop-blur-md">
                          <div class="text-[8px] text-slate-500 font-bold uppercase">WEEK</div>
                          <div class="text-2xl font-mono-tech font-bold text-[var(--cyan)] leading-none" id="protocol-week">01</div>
                      </div>
                  </div>

                  <div class="flex items-center gap-3 mb-5">
                      <div class="text-[10px] font-bold text-[var(--cyan)] bg-[var(--cyan)]/10 px-3 py-1 rounded border border-[var(--cyan)]/30 shadow-[0_0_10px_rgba(0,234,255,0.1)]" id="protocol-tech">TEMPO</div>
                      <div class="text-[10px] font-bold text-yellow-500 bg-yellow-500/10 px-3 py-1 rounded border border-yellow-500/30 shadow-[0_0_10px_rgba(234,179,8,0.1)]" id="protocol-rpe">RPE --</div>
                  </div>
                  
                  <div>
                      <div class="flex justify-between text-[9px] font-bold text-slate-500 uppercase mb-2 tracking-widest">
                          <span>BLOCK PROGRESSION</span>
                          <span class="text-white" id="protocol-percent">0%</span>
                      </div>
                      <div class="flex gap-1 h-1.5 w-full" id="protocol-bar">
                          <!-- Segments injected -->
                      </div>
                  </div>
              </div>
          </div>
      </section>

      <!-- VERTICAL WORKOUT STACK (SATURATED) -->
      <section class="animate-entry" style="animation-delay: 0.3s;">
          <div class="flex items-center justify-between mb-4 px-1">
              <h2 class="text-sm font-black text-white uppercase tracking-widest flex items-center gap-2">
                  <i data-lucide="crosshair" class="w-4 h-4 text-[var(--cyan)]"></i>
                  MISSIONS SEMAINE <span id="week-num">01</span>
              </h2>
          </div>
          
          <!-- Vertical Stack Container -->
          <div class="flex flex-col gap-4" id="workout-stack">
              <!-- Cards Injected by JS -->
          </div>
      </section>

      <!-- STORYTELLING QUOTE -->
      <div class="p-6 relative rounded-2xl border border-white/5 bg-gradient-to-r from-white/5 to-transparent backdrop-blur-md overflow-hidden touch-pop animate-entry" style="animation-delay: 0.4s;">
          <div class="absolute -right-2 -top-2 opacity-10"><i data-lucide="quote" class="w-20 h-20 text-white"></i></div>
          <p class="relative z-10 font-hud text-xl italic text-slate-200 leading-tight" id="daily-quote">
              "La douleur est temporaire. L'abandon est <span class="text-[var(--magenta)] font-bold text-shadow-magenta">définitif</span>."
          </p>
      </div>

  </main>

  <!-- BOTTOM NAV COCKPIT -->
  <nav class="fixed bottom-5 left-4 right-4 h-16 bg-[#0a0a15]/90 backdrop-blur-2xl border border-white/10 rounded-2xl flex justify-around items-center z-50 shadow-[0_10px_40px_rgba(0,0,0,0.5)]">
      <button class="flex flex-col items-center gap-1 w-12 text-[var(--cyan)] touch-pop">
          <i data-lucide="layout-grid" class="w-6 h-6 drop-shadow-[0_0_8px_rgba(0,234,255,0.6)]"></i>
          <span class="text-[8px] font-bold uppercase">QG</span>
      </button>
      <button onclick="window.location.href='workouts.html'" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="target" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">Ops</span>
      </button>
      
      <!-- FAB -->
      <div class="relative -top-6 flex gap-2">
          <button onclick="window.location.href='workouts.html'" class="w-16 h-16 rounded-full bg-gradient-to-br from-[var(--magenta)] to-purple-700 flex items-center justify-center shadow-[0_0_25px_rgba(255,45,149,0.5)] border-4 border-[#050510] transition-transform active:scale-90 touch-pop">
              <i data-lucide="zap" class="w-8 h-8 text-white fill-white"></i>
          </button>
      </div>

      <button onclick="window.location.href='stats.html'" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">Stats</span>
      </button>
      <button onclick="alert('Bientôt disponible')" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="user-circle" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">ID</span>
      </button>
  </nav>

  <!-- DETAILS MODAL -->
  <div id="details-modal" class="modal-overlay">
      <div class="modal-content">
          <div class="flex justify-between items-start mb-4">
              <div>
                  <h3 class="text-2xl font-hud font-black text-white uppercase italic" id="modal-title">TITRE</h3>
                  <div class="text-xs font-bold text-[var(--cyan)]" id="modal-subtitle">SUBTITLE</div>
              </div>
              <button onclick="closeModal()" class="p-2 bg-white/10 rounded-full touch-pop"><i data-lucide="x" class="w-5 h-5"></i></button>
          </div>
          <div id="modal-body" class="space-y-3">
              <!-- Exercises injected here -->
          </div>
          <div class="mt-6">
              <button id="modal-start-btn" class="w-full py-4 bg-[var(--cyan)] text-black font-black font-hud text-xl uppercase rounded-xl shadow-[0_0_20px_rgba(0,234,255,0.4)] touch-pop">
                  LANCER LA MISSION
              </button>
          </div>
      </div>
  </div>

  <script type="module">
    import programData from './program-data.js';

    // --- GAMIFICATION LOGIC ---
    const XP_LEVELS = [0, 1000, 2500, 5000, 10000];
    const RANKS = ["Recrue", "Soldat", "Vétéran", "Élite", "Légende"];
    const QUOTES = [
        "La douleur est temporaire. L'abandon est définitif.",
        "Le seul mauvais entraînement est celui que tu n'as pas fait.",
        "Ton corps peut tout supporter. C'est ta tête qu'il faut convaincre.",
        "Ne rêve pas de réussite. Entraîne-toi pour l'obtenir.",
        "La discipline est le pont entre les objectifs et l'accomplissement."
    ];
    
    function loadGamification() {
        const xp = parseInt(localStorage.getItem('hybrid_xp') || '0');
        let level = 1;
        let nextXp = XP_LEVELS[1];
        
        for(let i=0; i<XP_LEVELS.length; i++) {
            if(xp >= XP_LEVELS[i]) {
                level = i + 1;
                nextXp = XP_LEVELS[i+1] || 99999;
            }
        }
        
        const rank = RANKS[Math.min(level-1, RANKS.length-1)];
        const progress = Math.min(100, (xp / nextXp) * 100);

        document.getElementById('user-rank').textContent = `${rank} IV`;
        document.getElementById('level-display').textContent = level;
        document.getElementById('xp-display').textContent = `${xp} / ${nextXp} XP`;
        document.getElementById('xp-bar').style.width = `${progress}%`;
        
        // Random Quote
        const randomQuote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        const quoteEl = document.getElementById('daily-quote');
        const parts = randomQuote.split('.');
        if(parts.length > 1) {
             quoteEl.innerHTML = `${parts[0]}. <span class="text-[var(--magenta)] font-bold text-shadow-magenta">${parts[1]}</span>`;
        } else {
             quoteEl.textContent = randomQuote;
        }
    }

    // --- DASHBOARD LOGIC ---
    function initDashboard() {
        lucide.createIcons();
        loadGamification();
        
        const currentWeek = parseInt(localStorage.getItem('hybrid_current_week') || 1);
        document.getElementById('week-num').textContent = String(currentWeek).padStart(2, '0');
        
        // --- POPULATE PROTOCOL WIDGET ---
        const weekData = programData.getWeek(currentWeek);
        
        // FIX: Get Block Name Safely from Info
        let blockName = 'Unknown';
        if (programData.info && programData.info.blockTechniques) {
            const blockKey = `block${weekData.block}`;
            if (programData.info.blockTechniques[blockKey]) {
                blockName = programData.info.blockTechniques[blockKey].name;
            }
        }
        
        document.getElementById('protocol-title').textContent = blockName.toUpperCase();
        document.getElementById('protocol-subtitle').textContent = "BLOC " + weekData.block;
        document.getElementById('protocol-tech').textContent = weekData.technique.toUpperCase();
        document.getElementById('protocol-rpe').textContent = `RPE ${weekData.rpeTarget}`;
        document.getElementById('protocol-week').textContent = String(currentWeek).padStart(2, '0');
        
        // Protocol Bar Segments
        const weeksInBlock = 5; 
        const currentWeekInBlock = (currentWeek - 1) % 5 + 1;
        const segmentContainer = document.getElementById('protocol-bar');
        segmentContainer.innerHTML = '';
        
        for(let i=1; i<=weeksInBlock; i++) {
            const seg = document.createElement('div');
            const isActive = i <= currentWeekInBlock;
            seg.className = `flex-1 rounded-full h-full transition-all duration-500 ${isActive ? 'bg-[var(--cyan)] shadow-[0_0_5px_var(--cyan)]' : 'bg-white/10'}`;
            segmentContainer.appendChild(seg);
        }
        document.getElementById('protocol-percent').textContent = `${Math.round((currentWeekInBlock/weeksInBlock)*100)}%`;


        // --- POPULATE WORKOUT LIST (VERTICAL STACK) ---
        const container = document.getElementById('workout-stack');
        const days = ['dimanche', 'mardi', 'vendredi', 'maison'];
        
        const dayMeta = {
          'dimanche': { color: 'text-[var(--cyan)]', border: 'border-[var(--cyan)]', label: 'FORCE / HYBRIDE', img: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=1470&auto=format&fit=crop', tint: 'from-blue-900/60' },
          'mardi': { color: 'text-[var(--magenta)]', border: 'border-[var(--magenta)]', label: 'FORCE PUSH', img: 'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?q=80&w=1470&auto=format&fit=crop', tint: 'from-purple-900/60' },
          'vendredi': { color: 'text-[var(--cyan)]', border: 'border-[var(--cyan)]', label: 'HYBRIDE PULL', img: 'https://images.unsplash.com/photo-1605296867304-46d5465a13f1?q=80&w=1470&auto=format&fit=crop', tint: 'from-cyan-900/60' },
          'maison': { color: 'text-slate-400', border: 'border-slate-500', label: 'ACCESSOIRE', img: 'https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?q=80&w=1470&auto=format&fit=crop', tint: 'from-slate-900/60' }
        };

        days.forEach((day, index) => {
            const workout = weekData[day];
            if(!workout) return;
            const meta = dayMeta[day];

            let vol = 0;
            workout.exercises.forEach(ex => {
                const r = typeof ex.reps === 'string' ? 8 : ex.reps;
                vol += ex.sets * r * ex.weight;
            });
            
            // Status Logic
            let statusIcon = '';
            let opacityClass = 'opacity-100';
            let borderClass = 'border-white/10';
            
            if (index === 0) { 
                statusIcon = `<div class="absolute top-4 right-14 bg-green-500/20 text-green-400 px-2 py-1 rounded border border-green-500/50 text-[9px] font-bold flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> TERMINÉ</div>`;
                opacityClass = 'opacity-80 grayscale-[0.3]';
            } else if (index === 1) { 
                statusIcon = `<div class="absolute top-4 right-14 bg-[var(--cyan)]/20 text-[var(--cyan)] px-2 py-1 rounded border border-[var(--cyan)]/50 text-[9px] font-bold flex items-center gap-1 animate-pulse"><i data-lucide="zap" class="w-3 h-3"></i> EN COURS</div>`;
                borderClass = 'border-[var(--cyan)] shadow-[0_0_15px_rgba(0,234,255,0.2)]';
            }

            const card = document.createElement('div');
            card.className = `card-sheen relative group cursor-pointer touch-pop rounded-3xl overflow-hidden border bg-[#0f172a] ${borderClass} ${opacityClass} animate-entry`;
            card.style.height = "200px"; 
            card.style.animationDelay = `${0.3 + (index * 0.1)}s`;
            
            card.onclick = (e) => window.location.href = `session.html?week=${currentWeek}&day=${day}`;
            
            card.innerHTML = `
              <!-- Background Image with Zoom & Tint -->
              <div class="absolute inset-0 bg-cover bg-center opacity-60 group-active:scale-110 transition-transform duration-700 ease-out mix-blend-overlay" style="background-image: url('${meta.img}')"></div>
              <div class="absolute inset-0 bg-gradient-to-t from-[#050510] via-[#050510]/40 ${meta.tint} to-transparent"></div>
              
              <!-- Content -->
              <div class="absolute inset-0 p-6 flex flex-col justify-between z-10">
                  <div class="flex justify-between items-start w-full relative">
                      <div>
                          <span class="inline-block px-2 py-0.5 rounded bg-black/60 border ${meta.border} text-[9px] font-bold ${meta.color} uppercase backdrop-blur-md mb-2 shadow-lg">${meta.label}</span>
                          <h3 class="text-3xl font-hud font-black text-white italic uppercase leading-none drop-shadow-lg">${day}</h3>
                          <div class="text-sm text-slate-200 font-bold truncate max-w-[200px] mt-1 opacity-90">${workout.name.split('+')[0]}</div>
                      </div>
                      
                      ${statusIcon}
                      
                      <!-- DETAILS BUTTON (MODAL SCAN) -->
                      <button class="scan-btn w-10 h-10 rounded-full bg-black/30 border border-white/20 flex items-center justify-center backdrop-blur-md hover:bg-[var(--cyan)] hover:text-black transition-colors shadow-lg touch-pop z-20" data-day="${day}">
                          <i data-lucide="eye" class="w-5 h-5 pointer-events-none"></i>
                      </button>
                  </div>

                  <!-- Footer Info -->
                  <div class="flex gap-6 pt-2 mt-2">
                      <div>
                           <div class="text-[9px] text-slate-300 uppercase font-bold mb-0.5">DURÉE</div>
                           <div class="text-xs font-mono font-bold text-white flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3 text-[var(--cyan)]"></i> ${workout.duration}m</div>
                      </div>
                      <div>
                           <div class="text-[9px] text-slate-300 uppercase font-bold mb-0.5">VOLUME</div>
                           <div class="text-xs font-mono font-bold text-white flex items-center gap-1"><i data-lucide="dumbbell" class="w-3 h-3 text-[var(--magenta)]"></i> ${(vol/1000).toFixed(1)}t</div>
                      </div>
                      <div class="ml-auto flex items-end">
                           <span class="text-xs font-bold text-[var(--magenta)] glow-text-magenta">+500 XP</span>
                      </div>
                  </div>
              </div>
            `;
            container.appendChild(card);
        });
        
        document.querySelectorAll('.scan-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                openDetails(btn.dataset.day);
            });
        });

        lucide.createIcons();
    }

    // --- MODAL LOGIC ---
    window.openDetails = (day) => {
        const currentWeek = parseInt(localStorage.getItem('hybrid_current_week') || 1);
        const workout = programData.getWorkout(currentWeek, day);
        
        document.getElementById('modal-title').textContent = day.toUpperCase();
        document.getElementById('modal-subtitle').textContent = workout.name;
        
        const list = document.getElementById('modal-body');
        list.innerHTML = '';
        
        workout.exercises.forEach((ex, idx) => {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/5';
            item.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-6 h-6 rounded bg-white/10 flex items-center justify-center text-xs font-bold text-slate-400">${idx+1}</div>
                    <div>
                        <div class="text-sm font-bold text-white">${ex.name}</div>
                        <div class="text-[10px] text-slate-500 font-mono">${ex.sets} SETS x ${ex.reps} REPS</div>
                    </div>
                </div>
                <div class="text-xs font-bold text-[var(--cyan)]">${ex.weight}kg</div>
            `;
            list.appendChild(item);
        });
        
        document.getElementById('modal-start-btn').onclick = () => window.location.href = `session.html?week=${currentWeek}&day=${day}`;
        
        document.getElementById('details-modal').classList.add('open');
    };

    window.closeModal = () => {
        document.getElementById('details-modal').classList.remove('open');
    };

    // --- CANVAS ---
    const canvas = document.getElementById('matrix-bg');
    const ctx = canvas.getContext('2d');
    let w, h;
    function resize() { w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight; }
    window.addEventListener('resize', resize); resize();
    
    const particles = Array(40).fill().map(() => ({
        x: Math.random()*w, y: Math.random()*h, 
        s: Math.random()*2, a: Math.random() 
    }));
    
    function anim() {
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = '#00eaff';
        particles.forEach(p => {
            p.y -= p.s * 0.2;
            if(p.y < 0) p.y = h;
            ctx.globalAlpha = p.a * 0.2;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(anim);
    }
    anim();

    initDashboard();
  </script>
</body>
</html>


### 2. `workouts.html` (OPS)

```html
<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>NEON FIT // OPÉRATIONS</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Inter:wght@400;500;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --cyan: #00eaff;
      --magenta: #ff2d95;
      --dark-bg: #050510;
    }
    body {
      background-color: var(--dark-bg);
      font-family: 'Inter', sans-serif;
      color: white;
      padding-bottom: env(safe-area-inset-bottom);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .font-hud { font-family: 'Rajdhani', sans-serif; }
    
    /* Timeline Scroll */
    .timeline-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        padding: 0 20px;
        gap: 8px;
        scrollbar-width: none;
        margin-bottom: 12px;
        -webkit-overflow-scrolling: touch;
    }
    .timeline-container::-webkit-scrollbar { display: none; }
    .week-chip {
        scroll-snap-align: center;
        flex: 0 0 auto;
        width: 56px;
        height: 64px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 14px;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transform: translateZ(0);
        cursor: pointer;
    }
    .week-chip:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
    .week-chip.active {
        background: rgba(0, 234, 255, 0.15);
        border-color: var(--cyan);
        box-shadow: 0 0 15px rgba(0, 234, 255, 0.3);
    }
    /* Special Weeks */
    .week-chip.deload { border-color: #22c55e; color: #22c55e; }
    .week-chip.deload.active { background: rgba(34, 197, 94, 0.15); box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); }
    .week-chip.peak { border-color: #a855f7; color: #a855f7; }
    .week-chip.peak.active { background: rgba(168, 85, 247, 0.15); box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); }

    /* iPhone optimized touch feedback */
    .touch-pop {
        transition: transform 0.1s, filter 0.1s;
        transform: translateZ(0);
        cursor: pointer;
    }
    .touch-pop:active {
        transform: scale(0.97);
        filter: brightness(1.3);
    }

    /* Sheen Effect */
    .card-sheen { position: relative; overflow: hidden; }
    .card-sheen::after {
        content: ''; position: absolute; top: 0; left: -150%; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
        transform: skewX(-25deg); transition: left 0.5s; pointer-events: none;
    }
    .card-sheen:active::after { left: 150%; transition: left 0.3s; }

    /* STAGGERED ANIMATIONS */
    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-entry {
        animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
    }

    /* MODAL */
    .modal-overlay {
        position: fixed; inset: 0; z-index: 100;
        background: rgba(5, 5, 16, 0.95);
        backdrop-filter: blur(10px);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-content {
        width: 90%; max-height: 80vh; overflow-y: auto;
        background: #0f0f20; border: 1px solid rgba(255,255,255,0.1);
        border-radius: 24px; padding: 20px;
        transform: scale(0.9); transition: transform 0.3s;
    }
    .modal-overlay.open .modal-content { transform: scale(1); }
  </style>
</head>
<body class="antialiased pb-24">
  <script>document.addEventListener("touchstart", function(){}, true);</script>

  <!-- HEADER (Fixed Top) -->
  <header class="fixed top-0 w-full z-40 bg-[#050510]/95 backdrop-blur-md border-b border-white/10 pt-safe pb-2 shadow-2xl">
      <!-- Top Row -->
      <div class="px-4 h-12 flex items-center justify-between mb-2 mt-2">
          <h1 class="text-xl font-hud font-black text-white italic tracking-wider">OPÉRATIONS TACTIQUES</h1>
          <button onclick="window.location.href='index.html'" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400 touch-pop border border-white/10">
              <i data-lucide="x" class="w-5 h-5"></i>
          </button>
      </div>
      
      <!-- 3D TIMELINE -->
      <div class="timeline-container" id="timeline">
          <!-- JS Injected -->
      </div>
      
      <!-- BLOCK INFO BANNER (Dynamic) -->
      <div class="mx-4 mb-2 mt-2 p-3 rounded-xl bg-white/5 border border-white/10 flex items-center justify-between touch-pop" id="block-info-banner">
          <div>
              <div class="text-[9px] font-bold text-slate-400 uppercase tracking-widest" id="block-label">BLOC ACTIF</div>
              <div class="text-sm font-hud font-bold text-white leading-none mt-1" id="block-name">LOADING...</div>
          </div>
          <div class="text-right">
              <div class="text-[9px] font-bold text-[var(--cyan)] uppercase bg-[var(--cyan)]/10 px-2 py-1 rounded border border-[var(--cyan)]/20" id="block-tech">TECHNIQUE</div>
          </div>
      </div>
  </header>

  <!-- Padded Main Content -->
  <main class="pt-[240px] px-4 space-y-4">

      <!-- TROPHIES SECTION -->
      <section class="animate-entry" style="animation-delay: 0s;">
          <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 pl-1">Succès Récents</h2>
          <div class="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide">
              <div class="flex-shrink-0 w-28 bg-[#0a0a1a] border border-white/10 rounded-xl p-2 flex flex-col items-center justify-center gap-1 touch-pop">
                  <i data-lucide="medal" class="w-6 h-6 text-yellow-500 drop-shadow-md"></i>
                  <div class="text-[9px] text-center font-bold">Premier Sang</div>
              </div>
              <div class="flex-shrink-0 w-28 bg-[#0a0a1a] border border-white/10 rounded-xl p-2 flex flex-col items-center justify-center gap-1 touch-pop opacity-50 grayscale">
                  <i data-lucide="dumbbell" class="w-6 h-6 text-slate-600"></i>
                  <div class="text-[9px] text-center font-bold text-slate-500">Poids Lourd</div>
              </div>
              <div class="flex-shrink-0 w-28 bg-[#0a0a1a] border border-white/10 rounded-xl p-2 flex flex-col items-center justify-center gap-1 touch-pop opacity-50 grayscale">
                  <i data-lucide="flame" class="w-6 h-6 text-slate-600"></i>
                  <div class="text-[9px] text-center font-bold text-slate-500">Inferno</div>
              </div>
          </div>
      </section>

      <!-- WORKOUT LIST -->
      <section id="workouts-container" class="space-y-3">
          <!-- Injected by JS -->
      </section>

  </main>

  <!-- DETAILS MODAL -->
  <div id="details-modal" class="modal-overlay">
      <div class="modal-content">
          <div class="flex justify-between items-start mb-4">
              <div>
                  <h3 class="text-2xl font-hud font-black text-white uppercase italic" id="modal-title">TITRE</h3>
                  <div class="text-xs font-bold text-[var(--cyan)]" id="modal-subtitle">SUBTITLE</div>
              </div>
              <button onclick="closeModal()" class="p-2 bg-white/10 rounded-full touch-pop"><i data-lucide="x" class="w-5 h-5"></i></button>
          </div>
          <div id="modal-body" class="space-y-3">
              <!-- Exercises injected here -->
          </div>
          <div class="mt-6">
              <button id="modal-start-btn" class="w-full py-4 bg-[var(--cyan)] text-black font-black font-hud text-xl uppercase rounded-xl shadow-[0_0_20px_rgba(0,234,255,0.4)] touch-pop">
                  LANCER LA MISSION
              </button>
          </div>
      </div>
  </div>

  <script type="module">
    import programData from './program-data.js';

    // State
    let currentWeek = parseInt(localStorage.getItem('hybrid_current_week') || 1);

    function initOps() {
        lucide.createIcons();
        renderTimeline();
        renderWorkouts(currentWeek);
    }

    function renderTimeline() {
        const container = document.getElementById('timeline');
        container.innerHTML = '';
        
        // LOOP 26 WEEKS
        for(let i=1; i<=26; i++) { 
            const weekData = programData.getWeek(i);
            const isDeload = weekData.isDeload;
            const isPeak = i === 25;
            
            let extraClass = '';
            if (isDeload) extraClass = 'deload';
            if (isPeak) extraClass = 'peak';

            const chip = document.createElement('div');
            chip.className = `week-chip ${i === currentWeek ? 'active' : ''} ${extraClass} animate-entry`;
            chip.style.animationDelay = `${i * 0.02}s`;
            
            chip.onclick = () => {
                // Update UI instantly
                document.querySelectorAll('.week-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                
                // Update State
                currentWeek = i;
                localStorage.setItem('hybrid_current_week', i);
                
                // Haptic
                if(navigator.vibrate) navigator.vibrate(10);
                
                renderWorkouts(i);
            };
            
            const label = isDeload ? 'DELOAD' : (isPeak ? 'PEAK' : 'SEM');
            
            chip.innerHTML = `
                <span class="text-[7px] font-bold opacity-70 uppercase">${label}</span>
                <span class="text-xl font-hud font-bold">${i}</span>
            `;
            container.appendChild(chip);
        }
        
        // Scroll to active week
        setTimeout(() => {
            const active = container.querySelector('.active');
            if(active) active.scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }, 500);
    }

    function renderWorkouts(week) {
        const container = document.getElementById('workouts-container');
        container.innerHTML = '';
        
        const weekData = programData.getWeek(week);
        
        // UPDATE BLOCK BANNER
        // FIX: Get Block Name Safely
        let blockName = 'Unknown';
        if (programData.info && programData.info.blockTechniques) {
            const blockKey = `block${weekData.block}`;
            if (programData.info.blockTechniques[blockKey]) {
                blockName = programData.info.blockTechniques[blockKey].name;
            }
        }

        document.getElementById('block-label').textContent = `BLOC ${weekData.block} • SEMAINE ${week}`;
        document.getElementById('block-name').textContent = blockName.toUpperCase();
        document.getElementById('block-tech').textContent = weekData.technique;
        
        const days = ['dimanche', 'mardi', 'vendredi', 'maison'];

        const dayMeta = {
          'dimanche': { color: 'text-[var(--cyan)]', bg: 'bg-[var(--cyan)]/10', border: 'border-[var(--cyan)]/30', icon: 'zap' },
          'mardi': { color: 'text-[var(--magenta)]', bg: 'bg-[var(--magenta)]/10', border: 'border-[var(--magenta)]/30', icon: 'dumbbell' },
          'vendredi': { color: 'text-[var(--cyan)]', bg: 'bg-[var(--cyan)]/10', border: 'border-[var(--cyan)]/30', icon: 'activity' },
          'maison': { color: 'text-slate-400', bg: 'bg-slate-800', border: 'border-slate-700', icon: 'home' }
        };

        days.forEach((day, index) => {
            const workout = weekData[day];
            if(!workout) return;
            const meta = dayMeta[day];

            // Build Badge Logic based on Technique
            let techniqueBadge = `<span class="px-2 py-0.5 rounded bg-black/40 border border-white/10 text-[9px] font-bold ${meta.color} uppercase">${weekData.technique.split('+')[0]}</span>`;
            if(day === 'maison') techniqueBadge = `<span class="px-2 py-0.5 rounded bg-slate-800 border border-slate-700 text-[9px] font-bold text-slate-400 uppercase">ACCESSOIRE</span>`;

            let activeClass = 'border-white/10';

            const card = document.createElement('div');
            card.className = `card-sheen bg-[#0f172a] ${activeClass} border rounded-2xl p-4 touch-pop active:bg-[#1e293b] animate-entry relative overflow-hidden`;
            card.style.animationDelay = `${index * 0.1}s`;
            card.onclick = () => window.location.href = `session.html?week=${week}&day=${day}`;
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4 relative z-10">
                    <div class="w-12 h-12 rounded-xl ${meta.bg} border ${meta.border} flex items-center justify-center shadow-lg">
                        <i data-lucide="${meta.icon}" class="w-6 h-6 ${meta.color}"></i>
                    </div>
                    <div class="flex-1 ml-4">
                        <div class="flex items-center gap-2 mb-1">
                             ${techniqueBadge}
                             <span class="text-[9px] font-bold text-slate-500 uppercase tracking-wider">${day.toUpperCase()}</span>
                        </div>
                        <h3 class="text-lg font-hud font-black text-white italic uppercase leading-none">${workout.name.split('+')[0]}</h3>
                    </div>
                    
                    <!-- SCAN BUTTON -->
                    <button class="scan-btn w-10 h-10 rounded-full bg-white/5 flex items-center justify-center hover:bg-[var(--cyan)] hover:text-black transition-colors touch-pop border border-white/10" data-day="${day}">
                        <i data-lucide="eye" class="w-5 h-5 pointer-events-none"></i>
                    </button>
                </div>
                
                <div class="flex items-center justify-between border-t border-white/5 pt-3 relative z-10">
                    <div class="flex gap-4">
                        <div>
                            <div class="text-[8px] font-bold text-slate-500 uppercase">Durée</div>
                            <div class="text-sm font-mono font-bold text-white">${workout.duration}m</div>
                        </div>
                        <div>
                            <div class="text-[8px] font-bold text-slate-500 uppercase">Séries</div>
                            <div class="text-sm font-mono font-bold text-white">${workout.totalSets}</div>
                        </div>
                    </div>
                    <div class="text-right">
                         <div class="text-[8px] font-bold text-slate-500 uppercase">RPE Cible</div>
                         <div class="text-sm font-bold text-[var(--magenta)] glow-text-magenta">${weekData.rpeTarget}</div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
        
        document.querySelectorAll('.scan-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                openDetails(btn.dataset.day);
            });
        });
        
        lucide.createIcons();
    }

    // --- MODAL ---
    window.openDetails = (day) => {
        const workout = programData.getWorkout(currentWeek, day);
        document.getElementById('modal-title').textContent = day.toUpperCase();
        document.getElementById('modal-subtitle').textContent = workout.name;
        
        const list = document.getElementById('modal-body');
        list.innerHTML = '';
        
        workout.exercises.forEach((ex, idx) => {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/5';
            item.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-6 h-6 rounded bg-white/10 flex items-center justify-center text-xs font-bold text-slate-400">${idx+1}</div>
                    <div>
                        <div class="text-sm font-bold text-white">${ex.name}</div>
                        <div class="text-[10px] text-slate-500 font-mono">${ex.sets}x${ex.reps} • ${ex.weight}kg</div>
                    </div>
                </div>
            `;
            list.appendChild(item);
        });
        
        document.getElementById('modal-start-btn').onclick = () => window.location.href = `session.html?week=${currentWeek}&day=${day}`;
        document.getElementById('details-modal').classList.add('open');
    };

    window.closeModal = () => document.getElementById('details-modal').classList.remove('open');

    initOps();
  </script>
</body>
</html>


### 3. `session.html` (COCKPIT)

```html
<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>SESSION // COCKPIT TACTIQUE</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Inter:wght@400;500;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --cyan: #00eaff;
      --magenta: #ff2d95;
      --orange: #f97316;
      --bg: #050510;
      --panel-bg: rgba(20, 25, 40, 0.95);
    }
    body {
        background-color: var(--bg);
        font-family: 'Inter', sans-serif;
        color: white;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        touch-action: manipulation;
    }
    .font-hud { font-family: 'Rajdhani', sans-serif; }
    .font-mono-tech { font-family: 'Share Tech Mono', monospace; }

    .accel-gpu { transform: translateZ(0); will-change: transform; }

    /* --- CENTRAL REACTOR SVG --- */
    .cockpit-svg-container {
        width: 100%; height: 100%;
        display: flex; align-items: center; justify-content: center;
        position: relative;
    }
    .reactor-ring {
        fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 1;
        transform-origin: center; animation: spin 30s linear infinite;
    }
    .reactor-core {
        fill: var(--cyan); opacity: 0.2; filter: blur(20px);
        transition: fill 0.5s, opacity 0.5s;
    }
    .reactor-core.resting { fill: var(--orange); opacity: 0.4; animation: pulseCore 1s infinite alternate; }

    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes pulseCore { 0% { opacity: 0.2; transform: scale(1); } 100% { opacity: 0.5; transform: scale(1.1); } }

    /* --- TACTICAL INTEL PANEL --- */
    .intel-panel {
        background: var(--panel-bg);
        border: 1px solid rgba(0, 234, 255, 0.15);
        border-left: 4px solid var(--cyan);
        backdrop-filter: blur(10px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }

    /* --- FLASH SCREEN FEEDBACK --- */
    .flash-screen {
        position: fixed; inset: 0; pointer-events: none; z-index: 90;
        background: white; opacity: 0;
    }
    .flash-screen.hit { animation: flashHit 0.2s ease-out; }
    @keyframes flashHit { 0% { opacity: 0.2; } 100% { opacity: 0; } }

    /* --- ACTIVE STATE FOR BUTTONS --- */
    .touch-btn { transition: transform 0.05s, filter 0.1s; cursor: pointer; }
    .touch-btn:active { transform: scale(0.95); filter: brightness(1.3); }

    /* --- LCD DISPLAY --- */
    .lcd-panel {
        background: #0a0a15;
        border: 1px solid #334155;
        border-radius: 12px;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        position: relative;
    }
    .lcd-panel::before {
        content: ''; position: absolute; inset: 0;
        background: linear-gradient(rgba(255,255,255,0.03) 50%, transparent 50%);
        background-size: 100% 4px; pointer-events: none;
    }
  </style>
</head>
<body>
  <script>document.addEventListener("touchstart", function(){}, true);</script>

  <!-- XP FEEDBACK OVERLAY -->
  <div id="xp-flash" class="fixed inset-0 pointer-events-none z-[100] flex items-center justify-center opacity-0 scale-50 transition-all duration-500">
      <div class="text-center transform translate-y-[-50px]">
          <div class="text-4xl font-black font-hud text-[var(--magenta)] drop-shadow-[0_0_15px_rgba(255,45,149,0.8)]">+50 XP</div>
          <div class="text-sm font-bold text-white uppercase tracking-widest">SÉRIE VALIDÉE</div>
      </div>
  </div>
  <div class="flash-screen" id="flash-fx"></div>

  <!-- HEADER -->
  <header class="flex-none h-14 px-4 flex justify-between items-center bg-[#050510]/90 backdrop-blur-md border-b border-white/10 z-50">
      <button onclick="window.location.href='workouts.html'" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-slate-400 touch-btn">
          <i data-lucide="x" class="w-5 h-5"></i>
      </button>

      <div class="px-3 py-1 rounded-full bg-white/5 border border-white/10 flex items-center gap-2">
           <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
           <span class="text-xs font-mono-tech font-bold text-white" id="session-timer">00:00</span>
      </div>

      <div class="w-10 h-10 flex items-center justify-center touch-btn">
          <i data-lucide="more-vertical" class="w-5 h-5 text-slate-400"></i>
      </div>
  </header>

  <!-- MAIN HUD AREA -->
  <main class="flex-1 flex flex-col relative overflow-hidden">
      
      <!-- 1. VISUALIZER -->
      <div class="flex-1 relative flex items-center justify-center min-h-[300px]">
          <!-- Background Grid -->
          <div class="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px] opacity-30 pointer-events-none"></div>
          
          <div class="w-full h-full relative cockpit-svg-container accel-gpu" id="cockpit-visual">
               <svg viewBox="0 0 400 400" class="w-full h-full max-w-[400px]">
                    <defs>
                        <radialGradient id="coreGrad" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stop-color="currentColor" stop-opacity="0.3"/>
                            <stop offset="100%" stop-color="transparent"/>
                        </radialGradient>
                    </defs>
                    <!-- Rings -->
                    <circle cx="200" cy="200" r="140" class="reactor-ring" stroke-dasharray="10 5" opacity="0.3" />
                    <circle cx="200" cy="200" r="120" class="reactor-ring" stroke-dasharray="80 140" stroke="var(--magenta)" stroke-width="2" style="animation-duration: 15s; animation-direction: reverse;" />
                    <circle id="reactor-core-circle" cx="200" cy="200" r="80" fill="url(#coreGrad)" class="reactor-core text-[var(--cyan)]" />
                    <circle id="rest-progress-ring" cx="200" cy="200" r="95" fill="none" stroke="var(--orange)" stroke-width="6" stroke-linecap="round" stroke-dasharray="596" stroke-dashoffset="596" transform="rotate(-90 200 200)" opacity="0" />

                    <!-- Data Displays -->
                    <g id="data-mode-standard">
                        <text x="200" y="190" text-anchor="middle" fill="#fff" font-family="Rajdhani" font-size="60" font-weight="bold" id="current-set-disp">1</text>
                        <text x="200" y="220" text-anchor="middle" fill="#94a3b8" font-family="Share Tech Mono" font-size="14" letter-spacing="2">SÉRIE ACTUELLE</text>
                    </g>
                    <g id="data-mode-rest" opacity="0">
                        <text x="200" y="205" text-anchor="middle" fill="#fff" font-family="Share Tech Mono" font-size="50" font-weight="bold" id="rest-timer-txt">00:00</text>
                        <text x="200" y="235" text-anchor="middle" fill="var(--orange)" font-family="Rajdhani" font-size="12" font-weight="bold" letter-spacing="2">REFROIDISSEMENT</text>
                    </g>
               </svg>
          </div>

          <!-- TOP INTEL -->
          <div class="absolute top-4 left-4 right-4 space-y-2 pointer-events-none">
               <!-- SUPERSET BADGE ENRICHED -->
               <div id="superset-badge" class="hidden rounded-lg p-2 border border-[var(--magenta)] bg-gradient-to-r from-[rgba(255,45,149,0.2)] to-transparent flex items-center gap-3 backdrop-blur-md shadow-[0_0_15px_rgba(255,45,149,0.3)]">
                    <div class="w-8 h-8 rounded-full bg-[var(--magenta)] flex items-center justify-center animate-pulse">
                        <i data-lucide="link" class="w-4 h-4 text-white"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[9px] font-bold text-[var(--magenta)] uppercase tracking-widest">SUPERSET ACTIF</span>
                        <span class="text-xs text-white font-bold leading-none" id="superset-name">--</span>
                    </div>
               </div>
               
               <div class="intel-panel rounded-r-lg p-3">
                    <div class="flex justify-between items-start mb-1">
                        <span class="text-[9px] font-bold text-cyan-400 uppercase tracking-widest">RENSEIGNEMENTS TACTIQUES</span>
                        <span class="text-[9px] font-mono text-slate-400" id="block-tech">TEMPO</span>
                    </div>
                    <div class="text-sm text-slate-200 font-medium leading-tight" id="ex-notes">--</div>
               </div>
          </div>

          <!-- BOTTOM TITLE -->
          <div class="absolute bottom-4 left-4 right-4 pointer-events-none">
              <div class="flex items-center justify-between mb-1">
                  <span class="px-2 py-0.5 rounded bg-[var(--cyan)]/10 border border-[var(--cyan)]/30 text-[9px] font-bold text-[var(--cyan)] uppercase" id="muscle-tag">CIBLE</span>
                  <div class="flex gap-1" id="dots-container"></div>
              </div>
              <h1 class="text-3xl font-hud font-black text-white uppercase italic leading-none drop-shadow-md truncate" id="ex-name">CHARGEMENT...</h1>
          </div>
      </div>

      <!-- 2. CONTROL DECK -->
      <div class="bg-[#0f0f1a] border-t border-white/10 rounded-t-[30px] p-5 pb-10 shadow-[0_-10px_40px_rgba(0,0,0,0.5)] z-20">
          
          <!-- LCD Stats Row (Revised) -->
          <div class="lcd-panel flex justify-between mb-6 px-4 py-3">
              <div class="text-center w-1/3 border-r border-slate-700">
                  <div class="text-[8px] text-slate-500 uppercase font-bold mb-1">CIBLE</div>
                  <div class="text-lg font-mono-tech font-bold text-white"><span id="t-sets">0</span>×<span id="t-reps">0</span></div>
              </div>
              <div class="text-center w-1/3 border-r border-slate-700">
                  <div class="text-[8px] text-slate-500 uppercase font-bold mb-1">CHARGE</div>
                  <div class="text-lg font-mono-tech font-bold text-[var(--cyan)]" id="t-load">0</div>
              </div>
              <div class="text-center w-1/3">
                  <div class="text-[8px] text-slate-500 uppercase font-bold mb-1">REPOS</div>
                  <div class="text-lg font-mono-tech font-bold text-white" id="t-rest">90s</div>
              </div>
          </div>

          <!-- INPUTS (Big Buttons) -->
          <div class="grid grid-cols-2 gap-4 mb-6">
              <!-- Weight -->
              <div class="bg-slate-800/50 rounded-2xl p-2 flex flex-col items-center border border-white/5">
                  <span class="text-[8px] text-slate-500 uppercase font-bold mb-2">POIDS (KG)</span>
                  <div class="flex items-center justify-between w-full px-2">
                      <button onclick="modWeight(-2.5)" class="w-14 h-14 rounded-xl bg-white/10 flex items-center justify-center text-white text-2xl font-bold touch-btn active:bg-white/20 border border-white/5">-</button>
                      <span class="text-3xl font-hud font-bold text-white" id="in-weight">0</span>
                      <button onclick="modWeight(2.5)" class="w-14 h-14 rounded-xl bg-white/10 flex items-center justify-center text-white text-2xl font-bold touch-btn active:bg-white/20 border border-white/5">+</button>
                  </div>
              </div>
               <!-- Reps -->
              <div class="bg-slate-800/50 rounded-2xl p-2 flex flex-col items-center border border-white/5">
                  <span class="text-[8px] text-slate-500 uppercase font-bold mb-2">RÉPS</span>
                  <div class="flex items-center justify-between w-full px-2">
                      <button onclick="modReps(-1)" class="w-14 h-14 rounded-xl bg-white/10 flex items-center justify-center text-white text-2xl font-bold touch-btn active:bg-white/20 border border-white/5">-</button>
                      <span class="text-3xl font-hud font-bold text-white" id="in-reps">0</span>
                      <button onclick="modReps(1)" class="w-14 h-14 rounded-xl bg-white/10 flex items-center justify-center text-white text-2xl font-bold touch-btn active:bg-white/20 border border-white/5">+</button>
                  </div>
              </div>
          </div>

          <!-- BIG ACTION BUTTONS -->
          <div id="action-area">
              <button id="btn-validate" onclick="logSet()" class="w-full h-20 rounded-2xl bg-gradient-to-r from-[var(--cyan)] to-blue-600 flex items-center justify-center gap-3 shadow-[0_0_20px_rgba(0,234,255,0.4)] touch-btn group overflow-hidden relative">
                  <div class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-500"></div>
                  <span class="text-2xl font-hud font-black text-black uppercase tracking-widest">VALIDER SÉRIE</span>
                  <i data-lucide="check-circle-2" class="w-8 h-8 text-black fill-current"></i>
              </button>
              
              <button id="btn-skip-rest" onclick="skipRest()" class="hidden w-full h-20 rounded-2xl bg-white/10 border border-white/20 flex items-center justify-center gap-3 touch-btn">
                  <span class="text-xl font-hud font-bold text-white uppercase tracking-wider">PASSER LE REPOS</span>
                  <i data-lucide="fast-forward" class="w-6 h-6 text-white fill-current"></i>
              </button>
          </div>

      </div>

  </main>

  <script type="module">
    import programData from './program-data.js';

    // --- LOGIC ---
    let s = { week: 1, day: 'dimanche', exIdx: 0, setIdx: 0, startTime: Date.now() };
    let workout = null;
    let restTimer = null;
    let weekData = null;

    window.modWeight = (d) => {
        const el = document.getElementById('in-weight');
        let v = parseFloat(el.textContent) + d;
        if(v<0) v=0;
        el.textContent = v % 1 === 0 ? v : v.toFixed(1);
    };
    window.modReps = (d) => {
        const el = document.getElementById('in-reps');
        let v = parseInt(el.textContent) + d;
        if(v<0) v=0;
        el.textContent = v;
    };
    
    window.logSet = () => {
        // FX
        document.getElementById('flash-fx').classList.add('hit');
        setTimeout(()=>document.getElementById('flash-fx').classList.remove('hit'), 200);
        
        const xpFlash = document.getElementById('xp-flash');
        xpFlash.style.opacity = '1'; xpFlash.style.transform = 'scale(1)';
        setTimeout(() => { xpFlash.style.opacity = '0'; xpFlash.style.transform = 'scale(1.5) translateY(-50px)'; setTimeout(()=> { xpFlash.style.transform = 'scale(0.5)'; }, 300); }, 800);
        
        let currentXp = parseInt(localStorage.getItem('hybrid_xp') || '0');
        localStorage.setItem('hybrid_xp', currentXp + 50);

        const dots = document.getElementById('dots-container').children;
        if(dots[s.setIdx]) dots[s.setIdx].classList.add('bg-[var(--cyan)]', 'shadow-[0_0_5px_var(--cyan)]');
        
        s.setIdx++;
        document.getElementById('current-set-disp').textContent = s.setIdx + 1;
        
        const ex = workout.exercises[s.exIdx];
        const isFinished = s.setIdx >= ex.sets;
        
        startRest(ex.rest || 90, isFinished);
    };

    window.skipRest = () => {
        clearInterval(restTimer);
        document.getElementById('reactor-core-circle').classList.remove('resting');
        document.getElementById('reactor-core-circle').classList.add('text-[var(--cyan)]');
        document.getElementById('reactor-core-circle').classList.remove('text-[var(--orange)]');
        document.getElementById('rest-progress-ring').style.opacity = '0';
        document.getElementById('data-mode-standard').setAttribute('opacity', '1');
        document.getElementById('data-mode-rest').setAttribute('opacity', '0');
        document.getElementById('btn-validate').classList.remove('hidden');
        document.getElementById('btn-skip-rest').classList.add('hidden');

        if(window._nextEx) {
            loadEx(s.exIdx + 1);
        }
    };

    function init() {
        lucide.createIcons();
        const p = new URLSearchParams(window.location.search);
        s.week = parseInt(p.get('week')) || 1;
        s.day = p.get('day') || 'dimanche';
        
        try {
            weekData = programData.getWeek(s.week);
            workout = programData.getWorkout(s.week, s.day);
        } catch(e) { window.location.href='workouts.html'; return; }

        document.getElementById('block-tech').textContent = weekData.technique || "STANDARD";

        setInterval(() => {
            const d = Math.floor((Date.now() - s.startTime)/1000);
            const m = Math.floor(d/60).toString().padStart(2,'0');
            const sc = (d%60).toString().padStart(2,'0');
            document.getElementById('session-timer').textContent = `${m}:${sc}`;
        }, 1000);

        loadEx(0);
    }

    function loadEx(idx) {
        if(idx >= workout.exercises.length) {
            alert("MISSION ACCOMPLIE !");
            window.location.href='index.html';
            return;
        }
        s.exIdx = idx;
        s.setIdx = 0;
        const ex = workout.exercises[idx];

        document.getElementById('ex-name').textContent = ex.name;
        document.getElementById('muscle-tag').textContent = ex.muscle[0];
        document.getElementById('t-sets').textContent = ex.sets;
        document.getElementById('t-reps').textContent = ex.reps;
        document.getElementById('t-load').textContent = ex.weight + 'kg';
        document.getElementById('t-rest').textContent = (ex.rest||90) + 's';
        
        document.getElementById('in-weight').textContent = ex.weight;
        document.getElementById('in-reps').textContent = typeof ex.reps === 'string' ? 8 : ex.reps;
        document.getElementById('current-set-disp').textContent = "1";
        document.getElementById('ex-notes').textContent = ex.notes || "Exécution contrôlée.";

        const ssBadge = document.getElementById('superset-badge');
        if(ex.isSuperset) {
            ssBadge.classList.remove('hidden'); ssBadge.classList.add('flex');
            document.getElementById('superset-name').textContent = ex.supersetWith || "NEXT";
        } else {
            ssBadge.classList.add('hidden'); ssBadge.classList.remove('flex');
        }

        const dc = document.getElementById('dots-container');
        dc.innerHTML = '';
        for(let i=0; i<ex.sets; i++) {
            const d = document.createElement('div');
            d.className = 'w-2 h-2 rounded-full bg-white/20 transition-all';
            dc.appendChild(d);
        }
    }

    function startRest(duration, isExDone) {
        window._nextEx = isExDone;
        let rem = duration;
        const total = duration;
        if(restTimer) clearInterval(restTimer);
        
        document.getElementById('reactor-core-circle').classList.add('resting');
        document.getElementById('reactor-core-circle').classList.remove('text-[var(--cyan)]');
        document.getElementById('reactor-core-circle').classList.add('text-[var(--orange)]');
        document.getElementById('rest-progress-ring').style.opacity = '1';
        document.getElementById('data-mode-standard').setAttribute('opacity', '0');
        document.getElementById('data-mode-rest').setAttribute('opacity', '1');
        document.getElementById('btn-validate').classList.add('hidden');
        document.getElementById('btn-skip-rest').classList.remove('hidden');

        const ring = document.getElementById('rest-progress-ring');
        const circ = 596;

        const updateTimer = () => {
            rem--;
            const m = Math.floor(rem/60).toString().padStart(2,'0');
            const sc = (rem%60).toString().padStart(2,'0');
            document.getElementById('rest-timer-txt').textContent = `${m}:${sc}`;
            const offset = circ - ((rem / total) * circ);
            ring.style.strokeDashoffset = offset;

            if(rem <= 0) {
                if(navigator.vibrate) navigator.vibrate([200,100,200]);
                skipRest();
            }
        };
        updateTimer();
        restTimer = setInterval(updateTimer, 1000);
    }

    init();
  </script>
</body>
</html>
