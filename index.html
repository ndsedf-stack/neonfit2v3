<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>NEON FIT // DASHBOARD</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800;900&family=Inter:wght@400;500;600;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --cyan: #00eaff;
      --magenta: #ff2d95;
      --dark-bg: #050510;
    }
    body {
      background-color: var(--dark-bg);
      font-family: 'Inter', sans-serif;
      color: white;
      padding-bottom: env(safe-area-inset-bottom);
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .font-hud { font-family: 'Rajdhani', sans-serif; }
    .font-mono-tech { font-family: 'Share Tech Mono', monospace; }
    
    /* Neon Glows */
    .glow-text-cyan { text-shadow: 0 0 10px rgba(0, 234, 255, 0.6); }
    .glow-text-magenta { text-shadow: 0 0 10px rgba(255, 45, 149, 0.6); }

    /* XP Bar Animation */
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .xp-fill {
      background: linear-gradient(90deg, var(--cyan), #fff, var(--cyan));
      background-size: 200% 100%;
      animation: shimmer 3s infinite linear;
    }

    /* Canvas Background */
    #matrix-bg {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #050510 100%);
    }

    /* --- IPHONE OPTIMIZED INTERACTIONS --- */
    .touch-pop {
        transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), filter 0.1s;
        will-change: transform;
        transform: translateZ(0); /* GPU Accel */
        cursor: pointer;
    }
    .touch-pop:active {
        transform: scale(0.96);
        filter: brightness(1.3);
    }
    
    /* Sheen Effect for Cards */
    .card-sheen {
        position: relative;
        overflow: hidden;
    }
    .card-sheen::after {
        content: '';
        position: absolute;
        top: 0; left: -150%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transform: skewX(-25deg);
        transition: left 0.5s;
        pointer-events: none;
    }
    .card-sheen:active::after {
        left: 150%;
        transition: left 0.3s;
    }

    /* STAGGERED ANIMATIONS */
    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-entry {
        animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
    }

    /* MODAL */
    .modal-overlay {
        position: fixed; inset: 0; z-index: 100;
        background: rgba(5, 5, 16, 0.9);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-content {
        width: 90%; max-height: 80vh; overflow-y: auto;
        background: #0f0f20; border: 1px solid rgba(255,255,255,0.1);
        border-radius: 24px; padding: 20px;
        transform: scale(0.9); transition: transform 0.3s;
        box-shadow: 0 0 50px rgba(0,234,255,0.1);
    }
    .modal-overlay.open .modal-content { transform: scale(1); }
    
    /* Grid Pattern for Protocol Widget */
    .bg-grid-pattern {
        background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        background-size: 20px 20px;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body class="antialiased">
  <!-- FIX FOR IOS ACTIVE STATES -->
  <script>document.addEventListener("touchstart", function(){}, true);</script>

  <canvas id="matrix-bg"></canvas>

  <!-- GAMIFICATION HEADER -->
  <div class="fixed top-0 w-full z-50 bg-[#050510]/95 backdrop-blur-xl border-b border-white/10 pt-safe px-4 pb-3 shadow-lg">
      <div class="flex justify-between items-end mb-2">
          <div class="flex flex-col">
              <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-0.5">RANG OPÉRATEUR</span>
              <span class="text-base font-hud font-black text-white uppercase glow-text-cyan tracking-wide" id="user-rank">RECRUE IV</span>
          </div>
          <div class="text-right">
               <span class="text-xs font-mono-tech text-cyan-400 font-bold" id="xp-display">0 / 1000 XP</span>
          </div>
      </div>
      <!-- XP Bar -->
      <div class="h-2 w-full bg-slate-800/50 rounded-full overflow-hidden relative border border-white/5">
          <div class="h-full xp-fill absolute top-0 left-0 shadow-[0_0_10px_var(--cyan)]" id="xp-bar" style="width: 0%"></div>
      </div>
  </div>

  <main class="relative z-10 pt-[100px] pb-32 px-4 space-y-8">

      <!-- HERO SECTION -->
      <section class="mt-2 text-center animate-entry" style="animation-delay: 0s;">
          <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 mb-4 shadow-[0_0_20px_rgba(255,45,149,0.2)]">
              <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-magenta-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-[var(--magenta)]"></span>
              </span>
              <span class="text-[10px] font-bold uppercase tracking-widest text-slate-300">SYSTÈME V3.0 ELITE</span>
          </div>
          <h1 class="text-4xl font-hud font-black text-white italic leading-[0.9] mb-2 drop-shadow-xl">
              PASSEZ AU <br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-[var(--cyan)] to-[var(--magenta)] glow-text-cyan">NIVEAU SUPÉRIEUR</span>
          </h1>
          <p class="text-xs text-slate-400 max-w-[260px] mx-auto leading-relaxed">Accomplissez les missions. Gagnez de l'XP. Devenez une Élite.</p>
      </section>

      <!-- IDENTITY CARD (PREMIUM UNIFIED) -->
      <section class="animate-entry" style="animation-delay: 0.1s;">
          <div class="bg-[#0a0a15] border border-white/10 rounded-3xl p-1 relative overflow-hidden shadow-2xl touch-pop group">
              <!-- Animated Border Glow -->
              <div class="absolute inset-0 bg-gradient-to-r from-[var(--cyan)]/20 to-[var(--magenta)]/20 opacity-0 group-active:opacity-100 transition-opacity duration-300"></div>
              
              <div class="relative z-10 flex items-center justify-between bg-[#0f172a]/80 backdrop-blur-xl rounded-[20px] p-4">
                  <!-- Streak -->
                  <div class="flex-1 flex flex-col items-center border-r border-white/5">
                      <div class="relative mb-1">
                          <i data-lucide="flame" class="w-8 h-8 text-orange-500 fill-orange-500/20 drop-shadow-[0_0_15px_rgba(249,115,22,0.6)]"></i>
                      </div>
                      <div class="text-4xl font-hud font-black text-white leading-none">3</div>
                      <div class="text-[8px] font-bold text-slate-500 uppercase tracking-widest mt-1">SÉRIE JOURS</div>
                  </div>

                  <!-- Level Badge -->
                  <div class="flex-1 flex flex-col items-center">
                      <div class="relative mb-1">
                          <i data-lucide="award" class="w-8 h-8 text-[var(--cyan)] drop-shadow-[0_0_15px_rgba(0,234,255,0.6)]"></i>
                      </div>
                      <div class="text-4xl font-hud font-black text-white leading-none" id="level-display">1</div>
                      <div class="text-[8px] font-bold text-slate-500 uppercase tracking-widest mt-1">NIVEAU ACTUEL</div>
                  </div>
              </div>
          </div>
      </section>

      <!-- CURRENT PROTOCOL WIDGET (HOLOGRAPHIC GRID) -->
      <section class="animate-entry" style="animation-delay: 0.2s;">
          <div class="bg-[#0a0a15] border border-[var(--cyan)]/30 rounded-3xl p-5 shadow-[0_0_40px_rgba(0,234,255,0.1)] relative overflow-hidden touch-pop group">
              <!-- Grid Background -->
              <div class="absolute inset-0 bg-grid-pattern opacity-20"></div>
              <!-- Scanline -->
              <div class="absolute inset-0 bg-gradient-to-b from-transparent via-[var(--cyan)]/5 to-transparent h-[200%] translate-y-[-50%] animate-[spin_4s_linear_infinite] opacity-30 pointer-events-none"></div>
              
              <div class="relative z-10">
                  <div class="flex justify-between items-start mb-4">
                      <div>
                          <div class="text-[9px] font-bold text-cyan-500/80 uppercase tracking-[0.2em] mb-1 flex items-center gap-2">
                              <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full animate-pulse"></span> ACTIVE PROTOCOL
                          </div>
                          <h2 class="text-3xl font-hud font-black text-white leading-[0.9] tracking-wide" id="protocol-title">LOADING</h2>
                          <h3 class="text-2xl font-hud font-bold text-slate-400 leading-[0.9]" id="protocol-subtitle">...</h3>
                      </div>
                      <div class="bg-[#050510]/80 border border-white/10 rounded-xl p-2 text-center min-w-[60px] shadow-lg backdrop-blur-md">
                          <div class="text-[8px] text-slate-500 font-bold uppercase">WEEK</div>
                          <div class="text-2xl font-mono-tech font-bold text-[var(--cyan)] leading-none" id="protocol-week">01</div>
                      </div>
                  </div>

                  <div class="flex items-center gap-3 mb-5">
                      <div class="text-[10px] font-bold text-[var(--cyan)] bg-[var(--cyan)]/10 px-3 py-1 rounded border border-[var(--cyan)]/30 shadow-[0_0_10px_rgba(0,234,255,0.1)]" id="protocol-tech">TEMPO</div>
                      <div class="text-[10px] font-bold text-yellow-500 bg-yellow-500/10 px-3 py-1 rounded border border-yellow-500/30 shadow-[0_0_10px_rgba(234,179,8,0.1)]" id="protocol-rpe">RPE --</div>
                  </div>
                  
                  <div>
                      <div class="flex justify-between text-[9px] font-bold text-slate-500 uppercase mb-2 tracking-widest">
                          <span>BLOCK PROGRESSION</span>
                          <span class="text-white" id="protocol-percent">0%</span>
                      </div>
                      <div class="flex gap-1 h-1.5 w-full" id="protocol-bar">
                          <!-- Segments injected -->
                      </div>
                  </div>
              </div>
          </div>
      </section>

      <!-- VERTICAL WORKOUT STACK (SATURATED) -->
      <section class="animate-entry" style="animation-delay: 0.3s;">
          <div class="flex items-center justify-between mb-4 px-1">
              <h2 class="text-sm font-black text-white uppercase tracking-widest flex items-center gap-2">
                  <i data-lucide="crosshair" class="w-4 h-4 text-[var(--cyan)]"></i>
                  MISSIONS SEMAINE <span id="week-num">01</span>
              </h2>
          </div>
          
          <!-- Vertical Stack Container -->
          <div class="flex flex-col gap-4" id="workout-stack">
              <!-- Cards Injected by JS -->
          </div>
      </section>

      <!-- STORYTELLING QUOTE -->
      <div class="p-6 relative rounded-2xl border border-white/5 bg-gradient-to-r from-white/5 to-transparent backdrop-blur-md overflow-hidden touch-pop animate-entry" style="animation-delay: 0.4s;">
          <div class="absolute -right-2 -top-2 opacity-10"><i data-lucide="quote" class="w-20 h-20 text-white"></i></div>
          <p class="relative z-10 font-hud text-xl italic text-slate-200 leading-tight" id="daily-quote">
              "La douleur est temporaire. L'abandon est <span class="text-[var(--magenta)] font-bold text-shadow-magenta">définitif</span>."
          </p>
      </div>

  </main>

  <!-- BOTTOM NAV COCKPIT -->
  <nav class="fixed bottom-5 left-4 right-4 h-16 bg-[#0a0a15]/90 backdrop-blur-2xl border border-white/10 rounded-2xl flex justify-around items-center z-50 shadow-[0_10px_40px_rgba(0,0,0,0.5)]">
      <button class="flex flex-col items-center gap-1 w-12 text-[var(--cyan)] touch-pop">
          <i data-lucide="layout-grid" class="w-6 h-6 drop-shadow-[0_0_8px_rgba(0,234,255,0.6)]"></i>
          <span class="text-[8px] font-bold uppercase">QG</span>
      </button>
      <button onclick="window.location.href='workouts.html'" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="target" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">Ops</span>
      </button>
      
      <!-- FAB -->
      <div class="relative -top-6 flex gap-2">
          <button onclick="window.location.href='workouts.html'" class="w-16 h-16 rounded-full bg-gradient-to-br from-[var(--magenta)] to-purple-700 flex items-center justify-center shadow-[0_0_25px_rgba(255,45,149,0.5)] border-4 border-[#050510] transition-transform active:scale-90 touch-pop">
              <i data-lucide="zap" class="w-8 h-8 text-white fill-white"></i>
          </button>
      </div>

      <button onclick="window.location.href='stats.html'" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">Stats</span>
      </button>
      <button onclick="alert('Bientôt disponible')" class="flex flex-col items-center gap-1 w-12 text-slate-500 hover:text-white transition-colors touch-pop">
          <i data-lucide="user-circle" class="w-6 h-6"></i>
          <span class="text-[8px] font-bold uppercase">ID</span>
      </button>
  </nav>

  <!-- DETAILS MODAL -->
  <div id="details-modal" class="modal-overlay">
      <div class="modal-content">
          <div class="flex justify-between items-start mb-4">
              <div>
                  <h3 class="text-2xl font-hud font-black text-white uppercase italic" id="modal-title">TITRE</h3>
                  <div class="text-xs font-bold text-[var(--cyan)]" id="modal-subtitle">SUBTITLE</div>
              </div>
              <button onclick="closeModal()" class="p-2 bg-white/10 rounded-full touch-pop"><i data-lucide="x" class="w-5 h-5"></i></button>
          </div>
          <div id="modal-body" class="space-y-3">
              <!-- Exercises injected here -->
          </div>
          <div class="mt-6">
              <button id="modal-start-btn" class="w-full py-4 bg-[var(--cyan)] text-black font-black font-hud text-xl uppercase rounded-xl shadow-[0_0_20px_rgba(0,234,255,0.4)] touch-pop">
                  LANCER LA MISSION
              </button>
          </div>
      </div>
  </div>

  <script type="module">
    import programData from './program-data.js';

    // --- GAMIFICATION LOGIC ---
    const XP_LEVELS = [0, 1000, 2500, 5000, 10000];
    const RANKS = ["Recrue", "Soldat", "Vétéran", "Élite", "Légende"];
    const QUOTES = [
        "La douleur est temporaire. L'abandon est définitif.",
        "Le seul mauvais entraînement est celui que tu n'as pas fait.",
        "Ton corps peut tout supporter. C'est ta tête qu'il faut convaincre.",
        "Ne rêve pas de réussite. Entraîne-toi pour l'obtenir.",
        "La discipline est le pont entre les objectifs et l'accomplissement."
    ];
    
    function loadGamification() {
        const xp = parseInt(localStorage.getItem('hybrid_xp') || '0');
        let level = 1;
        let nextXp = XP_LEVELS[1];
        
        for(let i=0; i<XP_LEVELS.length; i++) {
            if(xp >= XP_LEVELS[i]) {
                level = i + 1;
                nextXp = XP_LEVELS[i+1] || 99999;
            }
        }
        
        const rank = RANKS[Math.min(level-1, RANKS.length-1)];
        const progress = Math.min(100, (xp / nextXp) * 100);

        document.getElementById('user-rank').textContent = `${rank} IV`;
        document.getElementById('level-display').textContent = level;
        document.getElementById('xp-display').textContent = `${xp} / ${nextXp} XP`;
        document.getElementById('xp-bar').style.width = `${progress}%`;
        
        // Random Quote
        const randomQuote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        const quoteEl = document.getElementById('daily-quote');
        const parts = randomQuote.split('.');
        if(parts.length > 1) {
             quoteEl.innerHTML = `${parts[0]}. <span class="text-[var(--magenta)] font-bold text-shadow-magenta">${parts[1]}</span>`;
        } else {
             quoteEl.textContent = randomQuote;
        }
    }

    // --- DASHBOARD LOGIC ---
    function initDashboard() {
        lucide.createIcons();
        loadGamification();
        
        const currentWeek = parseInt(localStorage.getItem('hybrid_current_week') || 1);
        document.getElementById('week-num').textContent = String(currentWeek).padStart(2, '0');
        
        // --- POPULATE PROTOCOL WIDGET ---
        const weekData = programData.getWeek(currentWeek);
        
        // FIX: Get Block Name Safely from Info
        let blockName = 'Unknown';
        if (programData.info && programData.info.blockTechniques) {
            const blockKey = `block${weekData.block}`;
            if (programData.info.blockTechniques[blockKey]) {
                blockName = programData.info.blockTechniques[blockKey].name;
            }
        }
        
        document.getElementById('protocol-title').textContent = blockName.toUpperCase();
        document.getElementById('protocol-subtitle').textContent = "BLOC " + weekData.block;
        document.getElementById('protocol-tech').textContent = weekData.technique.toUpperCase();
        document.getElementById('protocol-rpe').textContent = `RPE ${weekData.rpeTarget}`;
        document.getElementById('protocol-week').textContent = String(currentWeek).padStart(2, '0');
        
        // Protocol Bar Segments
        const weeksInBlock = 5; 
        const currentWeekInBlock = (currentWeek - 1) % 5 + 1;
        const segmentContainer = document.getElementById('protocol-bar');
        segmentContainer.innerHTML = '';
        
        for(let i=1; i<=weeksInBlock; i++) {
            const seg = document.createElement('div');
            const isActive = i <= currentWeekInBlock;
            seg.className = `flex-1 rounded-full h-full transition-all duration-500 ${isActive ? 'bg-[var(--cyan)] shadow-[0_0_5px_var(--cyan)]' : 'bg-white/10'}`;
            segmentContainer.appendChild(seg);
        }
        document.getElementById('protocol-percent').textContent = `${Math.round((currentWeekInBlock/weeksInBlock)*100)}%`;


        // --- POPULATE WORKOUT LIST (VERTICAL STACK) ---
        const container = document.getElementById('workout-stack');
        const days = ['dimanche', 'mardi', 'vendredi', 'maison'];
        
        const dayMeta = {
          'dimanche': { color: 'text-[var(--cyan)]', border: 'border-[var(--cyan)]', label: 'FORCE / HYBRIDE', img: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=1470&auto=format&fit=crop', tint: 'from-blue-900/60' },
          'mardi': { color: 'text-[var(--magenta)]', border: 'border-[var(--magenta)]', label: 'FORCE PUSH', img: 'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?q=80&w=1470&auto=format&fit=crop', tint: 'from-purple-900/60' },
          'vendredi': { color: 'text-[var(--cyan)]', border: 'border-[var(--cyan)]', label: 'HYBRIDE PULL', img: 'https://images.unsplash.com/photo-1605296867304-46d5465a13f1?q=80&w=1470&auto=format&fit=crop', tint: 'from-cyan-900/60' },
          'maison': { color: 'text-slate-400', border: 'border-slate-500', label: 'ACCESSOIRE', img: 'https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?q=80&w=1470&auto=format&fit=crop', tint: 'from-slate-900/60' }
        };

        days.forEach((day, index) => {
            const workout = weekData[day];
            if(!workout) return;
            const meta = dayMeta[day];

            let vol = 0;
            workout.exercises.forEach(ex => {
                const r = typeof ex.reps === 'string' ? 8 : ex.reps;
                vol += ex.sets * r * ex.weight;
            });
            
            // Status Logic
            let statusIcon = '';
            let opacityClass = 'opacity-100';
            let borderClass = 'border-white/10';
            
            if (index === 0) { 
                statusIcon = `<div class="absolute top-4 right-14 bg-green-500/20 text-green-400 px-2 py-1 rounded border border-green-500/50 text-[9px] font-bold flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> TERMINÉ</div>`;
                opacityClass = 'opacity-80 grayscale-[0.3]';
            } else if (index === 1) { 
                statusIcon = `<div class="absolute top-4 right-14 bg-[var(--cyan)]/20 text-[var(--cyan)] px-2 py-1 rounded border border-[var(--cyan)]/50 text-[9px] font-bold flex items-center gap-1 animate-pulse"><i data-lucide="zap" class="w-3 h-3"></i> EN COURS</div>`;
                borderClass = 'border-[var(--cyan)] shadow-[0_0_15px_rgba(0,234,255,0.2)]';
            }

            const card = document.createElement('div');
            card.className = `card-sheen relative group cursor-pointer touch-pop rounded-3xl overflow-hidden border bg-[#0f172a] ${borderClass} ${opacityClass} animate-entry`;
            card.style.height = "200px"; 
            card.style.animationDelay = `${0.3 + (index * 0.1)}s`;
            
            card.onclick = (e) => window.location.href = `session.html?week=${currentWeek}&day=${day}`;
            
            card.innerHTML = `
              <!-- Background Image with Zoom & Tint -->
              <div class="absolute inset-0 bg-cover bg-center opacity-60 group-active:scale-110 transition-transform duration-700 ease-out mix-blend-overlay" style="background-image: url('${meta.img}')"></div>
              <div class="absolute inset-0 bg-gradient-to-t from-[#050510] via-[#050510]/40 ${meta.tint} to-transparent"></div>
              
              <!-- Content -->
              <div class="absolute inset-0 p-6 flex flex-col justify-between z-10">
                  <div class="flex justify-between items-start w-full relative">
                      <div>
                          <span class="inline-block px-2 py-0.5 rounded bg-black/60 border ${meta.border} text-[9px] font-bold ${meta.color} uppercase backdrop-blur-md mb-2 shadow-lg">${meta.label}</span>
                          <h3 class="text-3xl font-hud font-black text-white italic uppercase leading-none drop-shadow-lg">${day}</h3>
                          <div class="text-sm text-slate-200 font-bold truncate max-w-[200px] mt-1 opacity-90">${workout.name.split('+')[0]}</div>
                      </div>
                      
                      ${statusIcon}
                      
                      <!-- DETAILS BUTTON (MODAL SCAN) -->
                      <button class="scan-btn w-10 h-10 rounded-full bg-black/30 border border-white/20 flex items-center justify-center backdrop-blur-md hover:bg-[var(--cyan)] hover:text-black transition-colors shadow-lg touch-pop z-20" data-day="${day}">
                          <i data-lucide="eye" class="w-5 h-5 pointer-events-none"></i>
                      </button>
                  </div>

                  <!-- Footer Info -->
                  <div class="flex gap-6 pt-2 mt-2">
                      <div>
                           <div class="text-[9px] text-slate-300 uppercase font-bold mb-0.5">DURÉE</div>
                           <div class="text-xs font-mono font-bold text-white flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3 text-[var(--cyan)]"></i> ${workout.duration}m</div>
                      </div>
                      <div>
                           <div class="text-[9px] text-slate-300 uppercase font-bold mb-0.5">VOLUME</div>
                           <div class="text-xs font-mono font-bold text-white flex items-center gap-1"><i data-lucide="dumbbell" class="w-3 h-3 text-[var(--magenta)]"></i> ${(vol/1000).toFixed(1)}t</div>
                      </div>
                      <div class="ml-auto flex items-end">
                           <span class="text-xs font-bold text-[var(--magenta)] glow-text-magenta">+500 XP</span>
                      </div>
                  </div>
              </div>
            `;
            container.appendChild(card);
        });
        
        document.querySelectorAll('.scan-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                openDetails(btn.dataset.day);
            });
        });

        lucide.createIcons();
    }

    // --- MODAL LOGIC ---
    window.openDetails = (day) => {
        const currentWeek = parseInt(localStorage.getItem('hybrid_current_week') || 1);
        const workout = programData.getWorkout(currentWeek, day);
        
        document.getElementById('modal-title').textContent = day.toUpperCase();
        document.getElementById('modal-subtitle').textContent = workout.name;
        
        const list = document.getElementById('modal-body');
        list.innerHTML = '';
        
        workout.exercises.forEach((ex, idx) => {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/5';
            item.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="w-6 h-6 rounded bg-white/10 flex items-center justify-center text-xs font-bold text-slate-400">${idx+1}</div>
                    <div>
                        <div class="text-sm font-bold text-white">${ex.name}</div>
                        <div class="text-[10px] text-slate-500 font-mono">${ex.sets} SETS x ${ex.reps} REPS</div>
                    </div>
                </div>
                <div class="text-xs font-bold text-[var(--cyan)]">${ex.weight}kg</div>
            `;
            list.appendChild(item);
        });
        
        document.getElementById('modal-start-btn').onclick = () => window.location.href = `session.html?week=${currentWeek}&day=${day}`;
        
        document.getElementById('details-modal').classList.add('open');
    };

    window.closeModal = () => {
        document.getElementById('details-modal').classList.remove('open');
    };

    // --- CANVAS ---
    const canvas = document.getElementById('matrix-bg');
    const ctx = canvas.getContext('2d');
    let w, h;
    function resize() { w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight; }
    window.addEventListener('resize', resize); resize();
    
    const particles = Array(40).fill().map(() => ({
        x: Math.random()*w, y: Math.random()*h, 
        s: Math.random()*2, a: Math.random() 
    }));
    
    function anim() {
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = '#00eaff';
        particles.forEach(p => {
            p.y -= p.s * 0.2;
            if(p.y < 0) p.y = h;
            ctx.globalAlpha = p.a * 0.2;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(anim);
    }
    anim();

    initDashboard();
  </script>
</body>
</html>
